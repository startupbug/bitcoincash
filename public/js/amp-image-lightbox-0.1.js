(self.AMP=self.AMP||[]).push({n:"amp-image-lightbox",v:"1508896929494",f:(function(AMP){var g;function l(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]}function n(a,b){return b.length>a.length?!1:0==a.lastIndexOf(b,0)};Date.now();self.log=self.log||{user:null,dev:null,userForEmbed:null};var p=self.log;function q(){if(!p.user)throw Error("failed to call initLogConstructor");return p.user}function r(){if(p.dev)return p.dev;throw Error("failed to call initLogConstructor");};function t(a,b){a=a.__AMP_TOP||a;return aa(a,b)}function ba(a){a=ca(a);a=ca(a);a=a.isSingleDoc()?a.win:a;return aa(a,"history")}function ca(a){return a.nodeType?t((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function aa(a,b){var c=a.services;c||(c=a.services={});var d=c;a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
    function da(a,b){for(var c,d=a;d&&d!==c;d=d.parentElement)if(b(d))return d;return null}function ea(a){var b="figure";if(a.closest)return a.closest(b);b=b.toUpperCase();return da(a,function(a){return a.tagName==b})}function fa(a,b){var c=a.getElementsByTagName(b);return c[0]||null};var u,ga="Webkit webkit Moz moz ms O o".split(" ");function ha(a,b,c){var d;var e=a.style;if(!n(b,"--")){u||(u=Object.create(null));var f=u[b];if(!f){f=b;if(void 0===e[b]){var h=b.charAt(0).toUpperCase()+b.slice(1);b:{for(var k=0;k<ga.length;k++){var m=ga[k]+h;if(void 0!==e[m]){h=m;break b}}h=""}void 0!==e[h]&&(f=h)}u[b]=f}b=f}b&&(a.style[b]=d?c+d:c)}function w(a,b){for(var c in b)ha(a,c,b[c])};function x(a){return!!(a.complete||"complete"==a.readyState||a.document&&"complete"==a.document.readyState)};function y(){this.H=null}g=y.prototype;g.add=function(a){var b=this;this.H||(this.H=[]);this.H.push(a);return function(){b.remove(a)}};g.remove=function(a){this.H&&(a=this.H.indexOf(a),-1<a&&this.H.splice(a,1))};g.removeAll=function(){this.H&&(this.H.length=0)};g.fire=function(a){if(this.H)for(var b=this.H,c=0;c<b.length;c++)(0,b[c])(a)};g.getHandlerCount=function(){return this.H?this.H.length:0};function z(a,b,c,d){return{left:a,top:b,width:c,height:d,bottom:b+d,right:a+c,x:a,y:b}}function A(a){return z(Number(a.left),Number(a.top),Number(a.width),Number(a.height))};function B(a,b,c){var d=this;this.Ua=t(a,"timer");this.$a=b;this.Xa=c||0;this.da=-1;this.Da=0;this.S=!1;this.Va=function(){return d.ma()}}B.prototype.isPending=function(){return-1!=this.da};B.prototype.schedule=function(a){var b=a||this.Xa;this.S&&10>b&&(b=10);var c=Date.now()+b;return!this.isPending()||-10>c-this.Da?(this.cancel(),this.Da=c,this.da=this.Ua.delay(this.Va,b),!0):!1};B.prototype.ma=function(){this.da=-1;this.Da=0;this.S=!0;this.$a();this.S=!1};
    B.prototype.cancel=function(){this.isPending()&&(this.Ua.cancel(this.da),this.da=-1)};function ia(a){var b=a.getAttribute("srcset");if(b){a=b.match(/\s*(?:[\S]*)(?:\s+(?:-?(?:\d+(?:\.(?:\d+)?)?|\.\d+)[a-zA-Z]))?(?:\s*,)?/g);q().assert(0<a.length,"srcset has to have at least one source: %s",void 0);for(var c=[],d=0;d<a.length;d++){var e=a[d].trim();","==e.substr(-1)&&(e=e.substr(0,e.length-1).trim());var f=e.split(/\s+/,2);if(0!=f.length&&(1!=f.length||f[0])&&(2!=f.length||f[0]||f[1]))if(e=f[0],1==f.length||2==f.length&&!f[1])c.push({url:e,width:void 0,dpr:1});else{var f=f[1].toLowerCase(),
        h=f.substring(f.length-1);"w"==h?c.push({url:e,width:parseFloat(f),dpr:void 0}):"x"==h&&c.push({url:e,width:void 0,dpr:parseFloat(f)})}}return new C(c)}var k=q().assert(a.getAttribute("src"),'Either non-empty "srcset" or "src" attribute must be specified: %s',a);return new C([{url:k,width:void 0,dpr:1}])}
    function C(a){q().assert(0<a.length,"Srcset must have at least one source");this.F=a;var b=!1,c=!1;for(a=0;a<this.F.length;a++){var d=this.F[a];q().assert((d.width||d.dpr)&&(!d.width||!d.dpr),"Either dpr or width must be specified");b=b||!!d.width;c=c||!!d.dpr}q().assert(!b||!c,"Srcset cannot have both width and dpr sources");b?this.F.sort(ja):this.F.sort(ka);this.mb=b;this.Ya=c}
    C.prototype.select=function(a,b){var c=-1;if(this.mb)a:{for(var c=-Infinity,d=this.F.length-1;0<=d;d--){var e=this.F[d].width/b;if(e>=a){c=1.1*(a-c)<e-a&&1.2>=a/c?d+1:d;break a}c=e}c=0}else if(this.Ya){a=-1;c=1E6;for(d=0;d<this.F.length;d++)e=Math.abs((this.F[d].dpr||1)-b),e<c&&(c=e,a=d);c=a}return-1!=c?this.F[c]:this.getLast()};C.prototype.getLast=function(){return this.F[this.F.length-1]};C.prototype.getSources=function(){return this.F};
    C.prototype.stringify=function(){for(var a=[],b=0;b<this.F.length;b++){var c=this.F[b];c.width?a.push(c.url+" "+c.width+"w"):c.dpr?a.push(c.url+" "+c.dpr+"x"):a.push(""+c.url)}return a.join(", ")};function ja(a,b){q().assert(a.width!=b.width,"Duplicate width: %s",a.width);return b.width-a.width}function ka(a,b){q().assert(a.dpr!=b.dpr,"Duplicate dpr: %s",a.dpr);return b.dpr-a.dpr};function D(a,b,c,d){var e=new la(0,0,a,b,c,d,1,1);return e.solveYValueFromXValue.bind(e)}function la(a,b,c,d,e,f,h,k){this.x0=a;this.y0=b;this.x1=c;this.y1=d;this.x2=e;this.y2=f;this.x3=h;this.y3=k}g=la.prototype;g.solveYValueFromXValue=function(a){return this.getPointY(this.solvePositionFromXValue(a))};
    g.solvePositionFromXValue=function(a){var b=1E-6,c=(a-this.x0)/(this.x3-this.x0);if(0>=c)return 0;if(1<=c)return 1;for(var d=0,e=1,f=0,h=0;8>h;h++){var f=this.getPointX(c),k=(this.getPointX(c+b)-f)/b;if(Math.abs(f-a)<b)return c;if(Math.abs(k)<b)break;else f<a?d=c:e=c,c-=(f-a)/k}for(h=0;Math.abs(f-a)>b&&8>h;h++)f<a?(d=c,c=(c+e)/2):(e=c,c=(c+d)/2),f=this.getPointX(c);return c};
    g.getPointX=function(a){if(0==a)return this.x0;if(1==a)return this.x3;var b=this.lerp(this.x0,this.x1,a),c=this.lerp(this.x1,this.x2,a),d=this.lerp(this.x2,this.x3,a),b=this.lerp(b,c,a),c=this.lerp(c,d,a);return this.lerp(b,c,a)};g.getPointY=function(a){if(0==a)return this.y0;if(1==a)return this.y3;var b=this.lerp(this.y0,this.y1,a),c=this.lerp(this.y1,this.y2,a),d=this.lerp(this.y2,this.y3,a),b=this.lerp(b,c,a),c=this.lerp(c,d,a);return this.lerp(b,c,a)};g.lerp=function(a,b,c){return a+c*(b-a)};
    var ma=D(.25,.1,.25,1),na=D(.42,0,1,1),oa=D(0,0,.58,1),pa=D(.42,0,.58,1),qa={linear:function(a){return a},ease:ma,"ease-in":na,"ease-out":oa,"ease-in-out":pa};function ra(a){if(!a)return null;if("string"==typeof a){if(-1!=a.indexOf("cubic-bezier")){var b=a.match(/cubic-bezier\((.+)\)/);if(b&&(b=b[1].split(",").map(parseFloat),4==b.length)){for(var c=0;4>c;c++)if(isNaN(b[c]))return null;return D(b[0],b[1],b[2],b[3])}return null}return qa[a]}return a};function sa(){}function E(a,b){this.T=a;this.V=b||t(self,"vsync");this.Pa=null;this.C=[]}function ta(a,b,c){var d=ua;return(new E(a)).setCurve(d).add(0,b,1).start(c)}E.prototype.setCurve=function(a){a&&(this.Pa=ra(a));return this};E.prototype.add=function(a,b,c,d){this.C.push({delay:a,func:b,duration:c,curve:ra(d)});return this};E.prototype.start=function(a){var b=new va(this.V,this.T,this.C,this.Pa,a);b.Ja();return b};
    function va(a,b,c,d,e){var f=this;this.V=a;this.T=b;this.C=[];for(b=0;b<c.length;b++){var h=c[b];this.C.push({delay:h.delay,func:h.func,duration:h.duration,curve:h.curve||d,started:!1,completed:!1})}this.Za=e;this.ob=this.nb=this.O=0;this.S=!1;this.Sa={};this.ca=new Promise(function(a,b){f.Ha=a;f.Ga=b});this.Ta=this.V.createAnimTask(this.T,{mutate:this.ib.bind(this)})}g=va.prototype;g.then=function(a,b){return a||b?this.ca.then(a,b):this.ca};g.thenAlways=function(a){a=a||sa;return this.then(a,a)};
    g.halt=function(a){F(this,!1,a||0)};g.Ja=function(){this.O=Date.now();this.S=!0;this.V.canAnimate(this.T)?this.Ta(this.Sa):(r().warn("Animation","cannot animate"),F(this,!1,0))};function F(a,b,c){if(a.S){a.S=!1;if(0!=c){1<a.C.length&&a.C.sort(function(a,b){return a.delay+a.duration-(b.delay+b.duration)});try{if(0<c)for(c=0;c<a.C.length;c++)a.C[c].func(1,!0);else for(var d=a.C.length-1;0<=d;d--)a.C[d].func(0,!1)}catch(e){r().error("Animation","completion failed: "+e,e),b=!1}}b?a.Ha():a.Ga()}}
    g.ib=function(){if(this.S){for(var a=Date.now(),b=Math.min((a-this.O)/this.Za,1),c=0;c<this.C.length;c++){var d=this.C[c];!d.started&&b>=d.delay&&(d.started=!0)}for(c=0;c<this.C.length;c++)if(d=this.C[c],d.started&&!d.completed)a:{var e,f;if(0<d.duration){if(e=f=Math.min((b-d.delay)/d.duration,1),d.curve&&1!=e)try{e=d.curve(f)}catch(h){r().error("Animation","step curve failed: "+h,h);F(this,!1,0);break a}}else e=f=1;1==f&&(d.completed=!0);try{d.func(e,d.completed)}catch(h){r().error("Animation","step mutate failed: "+
        h,h),F(this,!1,0)}}1==b?F(this,!0,0):this.V.canAnimate(this.T)?this.Ta(this.Sa):(r().warn("Animation","cancel animation"),F(this,!1,0))}};function wa(a){var b;b=void 0===b?" ":b;return function(c,d){for(var e=[],f=0;f<a.length;f++){var h=(0,a[f])(c,d);"string"==typeof h&&e.push(h)}return e.join(b)}}function G(a,b){return function(c,d){for(var e in b)ha(a,e,b[e](c,d))}}function H(a,b){return function(c){return a+(b-a)*c}}function xa(a,b){return function(c){var d=a(c);"number"==typeof d&&(d+="px");if(!b)return"translate("+d+")";c=b(c);"number"==typeof c&&(c+="px");return"translate("+d+","+c+")"}}
    function ya(a){return function(b){return"scale("+a(b)+")"}};function za(a,b,c,d){this.type=a;this.data=b;this.time=c;this.event=d}
    function Aa(a,b){this.N=a;this.l=[];this.ga=[];this.K=[];this.j=[];this.i=null;this.gb=b;this.ra=!1;this.ma=new B(a.ownerDocument.defaultView,this.Qa.bind(this));this.Ra=new y;this.Ea=Object.create(null);this.Oa=this.fb.bind(this);this.Ma=this.cb.bind(this);this.Na=this.eb.bind(this);this.La=this.bb.bind(this);this.N.addEventListener("touchstart",this.Oa);this.N.addEventListener("touchend",this.Ma);this.N.addEventListener("touchmove",this.Na);this.N.addEventListener("touchcancel",this.La);this.Fa=
        !1}function Ba(a){var b=a.__AMP_Gestures;b||(b=new Aa(a,!1),a.__AMP_Gestures=b);return b}g=Aa.prototype;g.cleanup=function(){this.N.removeEventListener("touchstart",this.Oa);this.N.removeEventListener("touchend",this.Ma);this.N.removeEventListener("touchmove",this.Na);this.N.removeEventListener("touchcancel",this.La);delete this.N.__AMP_Gestures;this.ma.cancel()};g.onGesture=function(a,b){var c=new a(this),d=c.getType(),e=this.Ea[d];e||(this.l.push(c),e=new y,this.Ea[d]=e);return e.add(b)};
    g.onPointerDown=function(a){return this.Ra.add(a)};g.fb=function(a){var b=Date.now();this.ra=!1;this.Ra.fire(a);for(var c=0;c<this.l.length;c++)if(!this.K[c]&&(this.j[c]&&this.j[c]<b&&I(this,c),this.l[c].onTouchStart(a))){var d=c;this.ga[d]=!0;this.j[d]=0}J(this,a)};g.eb=function(a){for(var b=Date.now(),c=0;c<this.l.length;c++)this.ga[c]&&(this.j[c]&&this.j[c]<b?I(this,c):this.l[c].onTouchMove(a)||I(this,c));J(this,a)};
    g.cb=function(a){for(var b=Date.now(),c=0;c<this.l.length;c++)this.ga[c]&&(this.j[c]&&this.j[c]<b?I(this,c):(this.l[c].onTouchEnd(a),(!this.j[c]||this.j[c]<b)&&I(this,c)));J(this,a)};g.bb=function(a){for(var b=0;b<this.l.length;b++){var c=b;this.K[c]=0;I(this,c)}J(this,a)};function J(a,b){var c=!!a.i||a.ra;a.ra=!1;if(!c)for(var d=Date.now(),e=0;e<a.l.length;e++)if(a.K[e]||a.j[e]&&a.j[e]>=d){c=!0;break}c&&(b.stopPropagation(),a.gb||b.preventDefault());a.Fa&&(a.Fa=!1,a.Qa())}
    g.Qa=function(){for(var a=Date.now(),b=-1,c=0;c<this.l.length;c++)if(!this.K[c])this.j[c]&&this.j[c]<a&&I(this,c);else if(-1==b||this.K[c]>this.K[b])b=c;if(-1!=b){for(var d=0,c=0;c<this.l.length;c++)!this.K[c]&&this.ga[c]&&(d=Math.max(d,this.j[c]-a));if(2>d){for(var a=b,c=this.l[a],e=0;e<this.l.length;e++)if(e!=a){var f=e;this.K[f]=0;I(this,f)}this.K[a]=0;this.j[a]=0;this.i=c;c.acceptStart()}else this.ma.schedule(d)}};function I(a,b){a.ga[b]=!1;a.j[b]=0;a.K[b]||a.l[b].acceptCancel()}
    function K(a,b){this.lb=a;this.ja=b}g=K.prototype;g.getType=function(){return this.lb};g.signalReady=function(a){var b=this.ja;if(b.i)this.acceptCancel();else{for(var c=Date.now(),d=0;d<b.l.length;d++)b.l[d]==this&&(b.K[d]=c+a,b.j[d]=0);b.Fa=!0}};g.signalPending=function(a){var b=this.ja;if(b.i)this.acceptCancel();else for(var c=Date.now(),d=0;d<b.l.length;d++)b.l[d]==this&&(b.j[d]=c+a)};g.signalEnd=function(){var a=this.ja;a.i==this&&(a.i=null,a.ra=!0)};
    g.signalEmit=function(a,b){var c=this.ja.Ea[this.getType()];c&&c.fire(new za(this.getType(),a,Date.now(),b))};g.acceptStart=function(){};g.acceptCancel=function(){};g.onTouchStart=function(){return!1};g.onTouchMove=function(){return!1};g.onTouchEnd=function(){};function Ca(){}var Da=Math.round(-16.67/Math.log(.95));function L(a,b,c){1>b&&(b=1);var d=a/b,e=.5+Math.min(b/33.34,.5);return d*e+c*(1-e)}function Ea(a,b,c,d,e,f){return(new Fa(a,b,c,d,e,f,void 0)).Ja()}function Fa(a,b,c,d,e,f,h){var k=this;this.V=h||t(self,"vsync");this.T=a;this.sa=f;this.a=b;this.b=c;this.wa=d;this.xa=e;this.s=this.o=0;this.A=this.O=Date.now();this.ca=new Promise(function(a,b){k.Ha=a;k.Ga=b});this.aa=!1}g=Fa.prototype;
    g.Ja=function(){this.aa=!0;if(.02>=Math.abs(this.wa)&&.02>=Math.abs(this.xa))this.sa(this.a,this.b),this.ta(!0);else{this.o=this.wa;this.s=this.xa;var a=this.hb.bind(this),b=this.ta.bind(this,!0);this.V.runAnimMutateSeries(this.T,a,5E3).then(b,b)}return this};g.halt=function(){this.aa&&this.ta(!1)};g.then=function(a,b){return a||b?this.ca.then(a,b):this.ca};g.thenAlways=function(a){a=a||Ca;return this.then(a,a)};
    g.hb=function(a,b){if(!this.aa)return!1;this.A=Date.now();this.a+=b*this.o;this.b+=b*this.s;if(!this.sa(this.a,this.b))return!1;var c=Math.exp(-a/Da);this.o=this.wa*c;this.s=this.xa*c;return.02<Math.abs(this.o)||.02<Math.abs(this.s)};g.ta=function(a){this.aa&&(this.aa=!1,this.A=Date.now(),this.sa(this.a,this.b),a?this.Ha():this.Ga())};function M(a){K.call(this,"tap",a);this.b=this.a=this.g=this.h=0}l(M,K);M.prototype.onTouchStart=function(a){a=a.touches;if(!a||1!=a.length)return!1;this.h=a[0].clientX;this.g=a[0].clientY;return!0};M.prototype.onTouchMove=function(a){return(a=a.changedTouches||a.touches)&&1==a.length&&(this.a=a[0].clientX,this.b=a[0].clientY,a=8<=Math.abs(this.b-this.g),8<=Math.abs(this.a-this.h)||a)?!1:!0};M.prototype.onTouchEnd=function(){this.signalReady(0)};
    M.prototype.acceptStart=function(){this.signalEmit({clientX:this.a,clientY:this.b},null);this.signalEnd()};function N(a){K.call(this,"doubletap",a);this.L=this.b=this.a=this.g=this.h=0}l(N,K);g=N.prototype;g.onTouchStart=function(a){if(1<this.L)return!1;a=a.touches;if(!a||1!=a.length)return!1;this.h=a[0].clientX;this.g=a[0].clientY;return!0};
    g.onTouchMove=function(a){return(a=a.changedTouches||a.touches)&&1==a.length&&(this.a=a[0].clientX,this.b=a[0].clientY,a=8<=Math.abs(this.b-this.g),8<=Math.abs(this.a-this.h)||a)?(this.acceptCancel(),!1):!0};g.onTouchEnd=function(){this.L++;2>this.L?this.signalPending(300):this.signalReady(0)};g.acceptStart=function(){this.L=0;this.signalEmit({clientX:this.a,clientY:this.b},null);this.signalEnd()};g.acceptCancel=function(){this.L=0};
    function O(a,b,c,d){K.call(this,a,b);this.ha=c;this.pa=d;this.i=!1;this.s=this.o=this.R=this.A=this.O=this.Y=this.X=this.b=this.a=this.g=this.h=0}l(O,K);g=O.prototype;g.onTouchStart=function(a){a=a.touches;if(!a||1!=a.length)return!1;this.O=Date.now();this.h=a[0].clientX;this.g=a[0].clientY;return!0};
    g.onTouchMove=function(a){var b=a.changedTouches||a.touches;if(b&&1==b.length){var c=b[0].clientX,b=b[0].clientY;this.a=c;this.b=b;if(this.i)this.U(!1,!1,a);else if(a=Math.abs(c-this.h),c=Math.abs(b-this.g),this.ha&&this.pa)(8<=a||8<=c)&&this.signalReady(-10);else if(this.ha)if(8<=a&&a>c)this.signalReady(-10);else{if(8<=c)return!1}else if(this.pa)if(8<=c&&c>a)this.signalReady(-10);else{if(8<=a)return!1}else return!1}return!0};g.onTouchEnd=function(a){this.ua(a)};
    g.acceptStart=function(){this.i=!0;this.X=this.h;this.Y=this.g;this.R=this.O;this.h=this.a;this.g=this.b;this.U(!0,!1,null)};g.acceptCancel=function(){this.i=!1};
    g.U=function(a,b,c){this.A=Date.now();var d=this.A-this.R;if(!b&&4<d||b&&16<d)this.o=L(this.a-this.X,d,this.o),this.s=L(this.b-this.Y,d,this.s),this.o=1E-4<Math.abs(this.o)?this.o:0,this.s=1E-4<Math.abs(this.s)?this.s:0,this.X=this.a,this.Y=this.b,this.R=this.A;this.signalEmit({first:a,last:b,time:this.A,deltaX:this.ha?this.a-this.h:0,deltaY:this.pa?this.b-this.g:0,velocityX:this.ha?this.o:0,velocityY:this.pa?this.s:0},c)};g.ua=function(a){this.i&&(this.i=!1,this.U(!1,!0,a),this.signalEnd())};
    function P(a){O.call(this,"swipe-xy",a,!0,!0)}l(P,O);function Q(a){K.call(this,"tapzoom",a);this.i=!1;this.s=this.o=this.R=this.A=this.O=this.Y=this.X=this.L=this.kb=this.jb=this.b=this.a=this.g=this.h=0}l(Q,K);g=Q.prototype;g.onTouchStart=function(a){if(this.i)return!1;a=a.touches;if(!a||1!=a.length)return!1;this.h=a[0].clientX;this.g=a[0].clientY;return!0};
    g.onTouchMove=function(a){var b=a.changedTouches||a.touches;if(b&&1==b.length)if(this.a=b[0].clientX,this.b=b[0].clientY,this.i)this.U(!1,!1,a);else if(a=8<=Math.abs(this.b-this.g),8<=Math.abs(this.a-this.h)||a){if(0==this.L)return this.acceptCancel(),!1;this.signalReady(0)}return!0};g.onTouchEnd=function(a){this.i?this.ua(a):(this.L++,1==this.L?(this.signalPending(400),this.jb=this.a,this.kb=this.b):this.acceptCancel())};g.acceptStart=function(){this.L=0;this.i=!0;this.U(!0,!1,null)};
    g.acceptCancel=function(){this.L=0;this.i=!1};g.U=function(a,b,c){this.A=Date.now();a?(this.O=this.A,this.o=this.s=0):2<this.A-this.R&&(this.o=L(this.a-this.X,this.A-this.R,this.o),this.s=L(this.b-this.Y,this.A-this.R,this.s));this.X=this.a;this.Y=this.b;this.R=this.A;this.signalEmit({first:a,last:b,centerClientX:this.h,centerClientY:this.g,deltaX:this.a-this.h,deltaY:this.b-this.g,velocityX:this.o,velocityY:this.s},c)};g.ua=function(a){this.i&&(this.i=!1,this.U(!1,!0,a),this.signalEnd())};var Ga={"amp-img":!0,"amp-anim":!0},R=D(.4,0,.2,1),S=D(.4,0,.2,1),ua=D(.4,0,.2,1.4);
    function Ha(a,b,c){this.ia=a;this.win=b;this.ab=c;this.qa=a.element.ownerDocument.createElement("div");this.qa.classList.add("i-amphtml-image-lightbox-viewer");this.m=a.element.ownerDocument.createElement("img");this.m.classList.add("i-amphtml-image-lightbox-viewer-image");this.qa.appendChild(this.m);this.na=null;this.W={alt:null,"aria-label":null,"aria-labelledby":null};this.ea=this.Z=0;this.u=z(0,0,0,0);this.I=z(0,0,0,0);this.Aa=this.la=this.fa=this.c=1;this.ka=2;this.za=this.ya=this.Ca=this.Ba=
        this.w=this.B=this.g=this.h=0;this.P=null;Ia(this)}g=Ha.prototype;g.getElement=function(){return this.qa};g.getImage=function(){return this.m};g.getViewerBox=function(){return this.u};g.getImageBox=function(){return this.I};g.getImageBoxWithOffset=function(){var a;if(0==this.B&&0==this.w)a=this.I;else{a=this.I;var b=this.B,c=this.w;a=0==b&&0==c||0==a.width&&0==a.height?a:z(a.left+b,a.top+c,a.width,a.height)}return a};
    g.reset=function(){var a=this;this.m.setAttribute("src","");Object.keys(this.W).forEach(function(b){a.m.removeAttribute(b);a.W[b]=null});this.m.removeAttribute("aria-describedby");this.na=null;this.I=z(0,0,0,0);this.ea=this.Z=0;this.fa=this.c=this.la=1;this.ka=2;this.za=this.ya=this.Ca=this.Ba=this.w=this.B=this.g=this.h=0;this.P&&this.P.halt();this.P=null};
    g.init=function(a,b){var c=this;this.Z=a.offsetWidth;this.ea=a.offsetHeight;this.na=ia(a);Object.keys(this.W).forEach(function(b){c.W[b]=a.getAttribute(b);c.W[b]&&c.m.setAttribute(b,c.W[b])});b&&x(b)&&b.src&&this.m.setAttribute("src",b.src)};
    g.measure=function(){this.u=A(this.qa.getBoundingClientRect());var a=Math.min(this.u.width/this.Z,this.u.height/this.ea),b=Math.min(this.Z*a,this.u.width),c=Math.min(this.ea*a,this.u.height);16>=b-this.Z&&(b=this.Z,c=this.ea);this.I=z(Math.round((this.u.width-b)/2),Math.round((this.u.height-c)/2),Math.round(b),Math.round(c));w(this.m,{top:this.I.top+"px",left:this.I.left+"px",width:this.I.width+"px",height:this.I.height+"px"});this.fa=this.c=1;this.g=this.w=this.h=this.B=0;T(this,this.c);U(this);
        return Ja(this)};function Ja(a){if(!a.na)return Promise.resolve();a.la=Math.max(a.la,a.c);var b=a.na.select(a.I.width*a.la,a.ia.getDpr()).url;return b==a.m.getAttribute("src")?Promise.resolve():t(a.win,"timer").promise(1).then(function(){a.m.setAttribute("src",b);return a.ab(a.m)})}
    function Ia(a){var b=Ba(a.m);b.onGesture(M,function(){a.ia.toggleViewMode()});b.onGesture(P,function(b){var c=b.data.deltaY,e=V(a,a.h+b.data.deltaX,!0),c=W(a,a.g+c,!0);X(a,a.c,e,c,!1);b.data.last&&Ka(a,b.data.velocityX,b.data.velocityY)});b.onPointerDown(function(){a.P&&a.P.halt()});b.onGesture(N,function(b){var c;c=1==a.c?a.ka:a.Aa;La(a,c,a.u.width/2-b.data.clientX,a.u.height/2-b.data.clientY,!0).then(function(){return Ma(a,0,0,0,0,0,0)})});b.onGesture(Q,function(b){Na(a,b.data.centerClientX,b.data.centerClientY,
        b.data.deltaX,b.data.deltaY);b.data.last&&Ma(a,b.data.centerClientX,b.data.centerClientY,b.data.deltaX,b.data.deltaY,b.data.velocityY,b.data.velocityY)})}function Y(a,b,c,d){return Math.max(b-d,Math.min(c+d,a))}function V(a,b,c){return Y(b,a.Ba,a.ya,c&&1<a.c?.25*a.u.width:0)}function W(a,b,c){return Y(b,a.Ca,a.za,c?.25*a.u.height:0)}
    function T(a,b){var c=0,d=0,e=a.u.height-a.I.height*b;0<=e?d=c=0:(d=e/2,c=-d);var f=0,h=0;b=a.u.width-a.I.width*b;0<=b?h=f=0:(h=b/2,f=-h);a.Ba=h;a.Ca=d;a.ya=f;a.za=c}function U(a){var b=a.m,c;c=a.B;var d=a.w;"number"==typeof c&&(c+="px");void 0===d?c="translate("+c+")":("number"==typeof d&&(d+="px"),c="translate("+c+", "+d+")");w(b,{transform:c+" "+("scale("+a.c+")")});1!=a.c&&a.ia.toggleViewMode(!0)}
    function Ka(a,b,c){var d=a.w-a.g;1==a.c&&10<Math.abs(d)?a.ia.close():(a.P=Ea(a.m,a.B,a.w,b,c,function(b,c){b=V(a,b,!0);c=W(a,c,!0);if(1>Math.abs(b-a.B)&&1>Math.abs(c-a.w))return!1;X(a,a.c,b,c,!1);return!0}),a.P.thenAlways(function(){a.P=null;return Oa(a)}))}function Na(a,b,c,d,e){var f=Math.sqrt(d*d+e*e),h=Math.abs(e)>Math.abs(d)?Math.sign(e):Math.sign(-d);if(0!=h){var k=a.fa*(1+h*f/100),m=a.u.width/2-b,v=a.u.height/2-c;d=Math.min(m,f/100*m);e=Math.min(v,f/100*v);La(a,k,d,e,!1)}}
    function La(a,b,c,d,e){b=Y(b,a.Aa,a.ka,.25);if(b!=a.c)return T(a,b),c=V(a,a.h+c*b,!1),d=W(a,a.g+d*b,!1),X(a,b,c,d,e)}function Ma(a,b,c,d,e,f,h){d=0==f&&0==h?Promise.resolve():Ea(a.m,d,e,f,h,function(d,e){Na(a,b,c,d,e);return!0}).thenAlways();var k=a.c>a.fa;return d.then(function(){return Oa(a)}).then(function(){k&&Ja(a)})}
    function X(a,b,c,d,e){var f=b-a.c,h=c-a.B,k=d-a.w,h=Math.sqrt(h*h+k*k),m=0;if(e)var v=250,m=Math.min(v,Math.max(v*h*.01,v*Math.abs(f)));if(16<m&&e){var Qa=H(a.c,b),Ra=H(a.B,c),Sa=H(a.w,d);e=ta(a.m,function(b){a.c=Qa(b);a.B=Ra(b);a.w=Sa(b);U(a)},m).thenAlways(function(){a.c=b;a.B=c;a.w=d;U(a)})}else a.c=b,a.B=c,a.w=d,U(a),e=e?Promise.resolve():void 0;return e}
    function Oa(a){var b=Y(a.c,a.Aa,a.ka,0);b!=a.c&&T(a,b);var c=V(a,a.B/a.c*b,!1),d=W(a,a.w/a.c*b,!1);return X(a,b,c,d,!0).then(function(){a.fa=a.c;a.h=a.B;a.g=a.w})}function Z(a){a=AMP.BaseElement.call(this,a)||this;a.va=-1;a.$=!1;a.ba=!1;a.Ia=null;a.D=null;a.oa=null;a.G=null;a.J=null;a.M=null;a.Ka=a.Wa.bind(a);return a}l(Z,AMP.BaseElement);g=Z.prototype;g.isLayoutSupported=function(a){return"nodisplay"==a};
    function Pa(a){if(!a.G){a.G=a.element.ownerDocument.createElement("div");a.G.classList.add("i-amphtml-image-lightbox-container");a.element.appendChild(a.G);a.J=new Ha(a,a.win,a.loadPromise.bind(a));a.G.appendChild(a.J.getElement());a.M=a.element.ownerDocument.createElement("div");a.M.setAttribute("id",a.element.getAttribute("id")+"-caption");a.M.classList.add("amp-image-lightbox-caption");a.M.classList.add("i-amphtml-image-lightbox-caption");a.G.appendChild(a.M);var b=a.element.ownerDocument.createElement("button"),
        c=a.element.getAttribute("data-close-button-aria-label")||"Close the lightbox";b.textContent=c;b.classList.add("i-amphtml-screen-reader");b.tabIndex=-1;b.addEventListener("click",function(){a.close()});a.element.appendChild(b);var d=Ba(a.element);a.element.addEventListener("click",function(b){a.ba||a.J.getImage().contains(b.target)||a.close()});d.onGesture(M,function(){a.ba||a.close()});d.onGesture(P,function(){})}}
    g.activate=function(a){var b=this;if(!this.$){Pa(this);var c=a.source;q().assert(c&&Ga[c.tagName.toLowerCase()],"Unsupported element: %s",c.tagName);this.$=!0;Ta(this);Ua(this,c);this.win.document.documentElement.addEventListener("keydown",this.Ka);this.getViewport().enterLightboxMode();Va(this);this.oa=this.getViewport().onChanged(function(){b.$&&(n(t(b.win,"platform").getIosVersionString(),"10.3")?t(b.win,"timer").delay(function(){b.J.measure()},500):b.J.measure())});ba(this.getAmpDoc()).push(this.close.bind(this)).then(function(a){b.va=
        a})}};g.Wa=function(a){27==a.keyCode&&this.close()};g.close=function(){this.$&&(this.ba=this.$=!1,Wa(this),this.oa&&(this.oa(),this.oa=null),this.getViewport().leaveLightboxMode(),-1!=this.va&&ba(this.getAmpDoc()).pop(this.va),this.win.document.documentElement.removeEventListener("keydown",this.Ka))};g.toggleViewMode=function(a){void 0!==a?this.G.classList.toggle("i-amphtml-image-lightbox-view-mode",a):this.G.classList.toggle("i-amphtml-image-lightbox-view-mode")};
    function Ua(a,b){a.Ia=b;a.D=fa(b,"img");a.J.init(a.Ia,a.D);var c=null;if(!c){var d=ea(b);d&&(c=fa(d,"figcaption"))}if(!c)var e=b.getAttribute("aria-describedby"),c=a.element.ownerDocument.getElementById(e);if(c){var f=c;b=a.M;for(var h=b.ownerDocument.createDocumentFragment(),f=f.firstChild;f;f=f.nextSibling)h.appendChild(f.cloneNode(!0));b.appendChild(h);a.J.getImage().setAttribute("aria-describedby",a.M.getAttribute("id"))}a.M.classList.toggle("i-amphtml-empty",!c)}
    function Ta(a){a.J.reset();for(var b=a.M;b.firstChild;)b.removeChild(b.firstChild);a.Ia=null;a.D=null;a.toggleViewMode(!1)}
    function Va(a){a.ba=!0;w(a.element,{opacity:0,display:""});a.J.measure();var b=new E(a.element);b.add(0,G(a.element,{opacity:H(0,1)}),.6,R);var c=null;if(a.D&&x(a.D)&&a.D.src){c=a.element.ownerDocument.createElement("div");c.classList.add("i-amphtml-image-lightbox-trans");a.element.ownerDocument.body.appendChild(c);var d=A(a.D.getBoundingClientRect()),e=a.J.getImageBox(),f=a.D.cloneNode(!0);f.className="";w(f,{position:"absolute",top:d.top+"px",left:d.left+"px",width:d.width+"px",height:d.height+
    "px",transformOrigin:"top left",willChange:"transform"});c.appendChild(f);a.D.classList.add("i-amphtml-ghost");var h=e.top-d.top,k=0!=d.width?e.width/d.width:1,m=Math.max(.2,Math.min(.8,Math.abs(h)/250*.8));b.add(0,G(f,{transform:wa([xa(H(0,e.left-d.left),H(0,h)),ya(H(1,k))])}),m,R);w(a.G,{opacity:0});b.add(.8,G(a.G,{opacity:H(0,1)}),.1,R);b.add(.9,G(c,{opacity:H(1,.01)}),.1,S)}b.start(500).thenAlways(function(){a.ba=!1;w(a.element,{opacity:""});w(a.G,{opacity:""});c&&a.element.ownerDocument.body.removeChild(c)})}
    function Wa(a){var b=a.J.getImage(),c=a.J.getImageBoxWithOffset(),d=new E(a.element),e=500;d.add(0,G(a.element,{opacity:H(1,0)}),.9,S);var f=null;if(x(b)&&b.src&&a.D){f=a.element.ownerDocument.createElement("div");f.classList.add("i-amphtml-image-lightbox-trans");a.element.ownerDocument.body.appendChild(f);var h=A(a.D.getBoundingClientRect()),k=b.cloneNode(!0);w(k,{position:"absolute",top:c.top+"px",left:c.left+"px",width:c.width+"px",height:c.height+"px",transform:"",transformOrigin:"top left",willChange:"transform"});
        f.appendChild(k);d.add(0,G(a.G,{opacity:H(1,0)}),.1,S);var b=h.top-c.top,m=0!=c.width?h.width/c.width:1,v=G(k,{transform:wa([xa(H(0,h.left-c.left),H(0,b)),ya(H(1,m))])}),c=Math.max(.2,Math.min(.8,Math.abs(b)/250*.8));d.add(Math.min(.8-c,.2),function(b,c){v(b);c&&a.D.classList.remove("i-amphtml-ghost")},c,S);d.add(.8,G(f,{opacity:H(1,.01)}),.2,S);e=Math.max(Math.min(Math.abs(b)/250*e,e),300)}d.start(e).thenAlways(function(){a.D&&a.D.classList.remove("i-amphtml-ghost");a.collapse();w(a.element,{opacity:""});
        w(a.G,{opacity:""});f&&a.element.ownerDocument.body.removeChild(f);Ta(a)})}(function(a){a.registerElement("amp-image-lightbox",Z,"amp-image-lightbox{position:fixed!important;top:0!important;left:0!important;bottom:0!important;right:0!important;margin:0!important;padding:0!important;overflow:hidden!important;-webkit-transform:translateZ(0)!important;transform:translateZ(0)!important;-ms-touch-action:none!important;touch-action:none!important;z-index:1000;background:rgba(0,0,0,.95);color:#f2f2f2}.i-amphtml-image-lightbox-container{position:absolute;z-index:0;top:0;left:0;right:0;bottom:0;overflow:hidden;-webkit-transform:translateZ(0);transform:translateZ(0)}.i-amphtml-image-lightbox-trans{pointer-events:none!important;position:fixed;z-index:1001;top:0;left:0;bottom:0;right:0}.i-amphtml-image-lightbox-caption{position:absolute!important;z-index:2;bottom:0!important;left:0!important;right:0!important}.i-amphtml-image-lightbox-caption.i-amphtml-empty,.i-amphtml-image-lightbox-view-mode .i-amphtml-image-lightbox-caption{visibility:hidden}.amp-image-lightbox-caption{background:rgba(0,0,0,.5);max-height:25%;padding:8px}.i-amphtml-image-lightbox-viewer{position:absolute;z-index:1;top:0;left:0;right:0;bottom:0;overflow:hidden;-webkit-transform:translateZ(0);transform:translateZ(0)}.i-amphtml-image-lightbox-viewer-image{position:absolute;z-index:1;display:block;-webkit-transform-origin:50% 50%;transform-origin:50% 50%}\n/*# sourceURL=/extensions/amp-image-lightbox/0.1/amp-image-lightbox.css*/")})(self.AMP);
})});
//# sourceMappingURL=amp-image-lightbox-0.1.js.map
